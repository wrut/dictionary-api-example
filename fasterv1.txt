import openpyxl
import requests
from concurrent.futures import ThreadPoolExecutor

# Open the text file containing the words
with open("words.txt") as file:
    # Read the words from the file and store them in a list
    word_list = file.read().splitlines()

# Create a new Excel workbook
workbook = openpyxl.Workbook()

# Get the active sheet in the workbook
sheet = workbook.active

# Use a ThreadPoolExecutor to make requests to the dictionary API in parallel
with ThreadPoolExecutor() as executor:
    # Loop through the words in the list
    for word, response in zip(word_list, executor.map(lambda w: requests.get(f"https://api.dictionaryapi.dev/api/v2/entries/en/{w}"), word_list)):
        # Parse the JSON data and extract the first definition and example sentence
        try:
            data = response.json()  # Move this line inside the try block

            # Check if the word was found in the dictionary
            if "title" in data and data["title"] == "No Definitions Found":
                print(f"Word '{word}' was not found in the dictionary")
                continue

            # If the word was found, extract its definition and example sentence
            if data and len(data) > 0:  # Check if the list is not empty
                meanings = data[0]["meanings"]
                for meaning in meanings:
                    definition = meaning["definitions"][0]["definition"]
                    if "example" in meaning["definitions"][0]:
                        example_sentence = meaning["definitions"][0]["example"]
                    else:
                        example_sentence = ""

                    # Replace the word in the example sentence with a blank space
                    blank_sentence = example_sentence.replace(word, "___")

                    # Add a new row to the sheet with the word, its definition, example sentence, and blank sentence
                    sheet.append([word, definition, example_sentence, blank_sentence])

        except ValueError as error:
            # Print an error message if there is a problem parsing the JSON data
            print(f"Error parsing JSON data for word '{word}': {error}")
            continue

# Save the workbook to a file
workbook.save("words.xlsx")